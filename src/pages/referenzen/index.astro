---
import { useStoryblokApi } from '@storyblok/astro';
import Projects from '../../components/sections/projects/index.astro';
import DefaultDark from '../../layouts/DefaultDark.astro';
export const prerender = false; // for handling search params

const url = Astro.url;
const filter = url.searchParams.get('filter') || '';
const search = url.searchParams.get('search') || '';

const { data } = await useStoryblokApi().get('cdn/stories', {
	content_type: 'smartops_project',
	per_page: 100,
	sort_by: 'content.project_title:asc',
	filter_query: {
		project_categories: {
			all_in_array: filter,
		},
	},
	search_term: search,
});
---

<DefaultDark>
	<div class='px-sm py-lg'>
		<Projects projects={data.stories} />
	</div>
</DefaultDark>
