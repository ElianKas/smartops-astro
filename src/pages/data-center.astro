---
import DefaultDark from '../layouts/DefaultDark.astro';
import { resizeImage } from '../utils/useImageOptimization';
import Infobanner from '../components/sections/data-center/infobanner.astro';
import Cards from '../components/sections/data-center/cards.astro';
import DataGermany from '../components/sections/data-center/data-germany.astro';
import ShortArrow from '../components/Svg/Icons/ShortArrow.astro';
import BatteryTabs from '../components/sections/data-center/battery-tabs.astro';
import Links from '../components/sections/data-center/links.astro';
import { fetchAllTimeSeriesData } from '../utils/useSmardApi';
import { fetchSumMastr } from '../utils/useMastrApi';

const { finalSmardValues: dailySmard } = await fetchAllTimeSeriesData('DE', 'day');
const { finalSmardValues: monthlySmard } = await fetchAllTimeSeriesData('DE', 'month');
const { finalSmardValues: yearlySmard } = await fetchAllTimeSeriesData('DE', 'year');

const finalMastrValues = await fetchSumMastr();
---

<DefaultDark>
	<div class='flex flex-col gap-lg relative py-lg'>
		<img
			class='w-full min-h-screen object-cover fixed left-0 top-0 z-[-1] opacity-50'
			src={resizeImage('https://a.storyblok.com/f/316521/3840x2152/b58326ae7a/windpark_sea.jpg')}
			alt='Windpark im Meer, Stromerzeugung'
		/>
		<div class='flex flex-col gap-xs'>
			<div
				tabindex='0'
				class='bg-lavender px-sm group'>
				<div class='max-w-big mx-auto flex max-lg:flex-col gap-md lg:gap-lg py-xs text-gray'>
					<h1 class='font-bold text-dark flex items-center gap-xs'>
						<ShortArrow class='lg:hidden rotate-270 h-[15px] w-auto' />
						<div class='max-lg:cursor-pointer'>Data-Center</div>
					</h1>
					<nav class='hidden group-focus:flex lg:flex gap-md flex-wrap'>
						<a
							href='#ueberblick'
							class='hover:text-dark'
							>Ãœberblick</a
						>
						<a
							href='#planung'
							class='hover:text-dark'
							>Stand / Planung</a
						>
						<a
							href='#speicher'
							class='hover:text-dark'
							>Speicher</a
						>
						<a
							href='#links'
							class='hover:text-dark'
							>Links</a
						>
					</nav>
				</div>
			</div>
			<Infobanner filterOutputs={dailySmard.filterOutputs} />
		</div>
		<div class='text-center py-lg'>
			<div>Information EE</div>
			<div class='title'>Data-Center</div>
		</div>
		<Cards
			dailyPercent={dailySmard.resGenerationEEPercentage}
			mastrValues={finalMastrValues}
		/>
		<DataGermany
			targetDayPercentages={dailySmard.targetPercentagesEE}
			targetMonthPercentages={monthlySmard.targetPercentagesEE}
			targetYearPercentages={yearlySmard.targetPercentagesEE}
			dayPercentages={dailySmard.pastPercentagesEE}
			monthPercentages={monthlySmard.pastPercentagesEE}
			yearPercentages={yearlySmard.pastPercentagesEE}
			dailyPercent={dailySmard.resGenerationEEPercentage}
			daily={dailySmard.resGenerationEEGwh}
		/>
		<BatteryTabs />
		<Links />
		<div class='flex flex-col gap-xs'>
			<Infobanner filterOutputs={dailySmard.filterOutputs} />
		</div>
	</div>
</DefaultDark>
